# 第1章 开始

我们的程序显然必须：

* 定义变量。
* 进行输入和输出。
* 使用数据结构保存数据。
* 检测两条记录是否有相同的 `ISBN` 。
* 包含一个循环来处理销售档案中的每条记录。

## 1.1 编写一个简单的C++程序

每个 C++ 程序都包含一个或者多个 **函数** ，其中一个必须命名为 `main` 。操作系统通过调用 `main` 函数来运行 C++ 程序。

下面是一个非常简单的 `main` 函数，它什么也不干，只是返回给操作系统一个值：

```C++
int main(int argc, char const *argv[])
{
    return 0;
}
```

一个函数的定义包含 **四部分** ：

* 返回类型。
* 函数名。
* 一个括号包围的形参列表。
* 函数体。

**`main` 函数的返回类型必须为 `int`  ，即整数类型** 。`int` 类型是一种 **内置类型**， **<u>即语言自身定义的类型</u>** 。

函数定义的最后一个部分是 **函数体** ， **它是以包裹在花括号之内的语句块构成的** 。

当 `return` 语句包括一个值时，此时 **<u>返回值的类型必须与函数的返回类型相容</u>** 。

大多数系统中， `main` 函数的返回值被用来指示状态。返回值 `0` 表明成功，非 `0` 的返回值含义由系统定义，通常用来指出错误类型。

#### 重要概念：类型

类型是程序设计最基本的概念之一，在本书中我们会反复遇到它。 **<u>一种类型不仅定义了数据元素的内容，还定义了这类数据上可以进行的计算</u>** 。

程序所处理的数据都保存在变量中，而每个变量都有自己的类型。如果一个名为 `v` 的变量的类型为 `T` ，我们通常说 **`v` 具有类型 `T`**，或等价的，**`v` 是一个 `T` 类型的变量** 。

### 1.1.1 编译、运行程序

编写好程序之后，我们就需要编译它。如何编译程序依赖于你使用的操作系统和编译器。

#### 程序源文件命名约定

程序文件通常被称为 **源文件** 。在大多数系统中，源文件的名字以一个后缀为结尾，后缀是由一个句点后接一个或多个字符组成的。不同的编译器使用不同的后缀命名约定。

#### 从命令行运行编译器

运行 `GNU` 编译器的命令是 `g++` ：`g++ -o prog1 prog1.cpp`

## 1.2 初识输入输出

**C++ 语言并未定义任何输入输出语句** ，取而代之，包含了一个全面的标准库来提供 IO 机制。

本书中很多示例都使用了 `iostream` 库。 `iostream` 库包含两个基础类型 `std::istream` 和 `std::ostream` ，分别表示 **输入流** 和 **输出流** 。**一个流就是一个字符序列，是从IO设备读出或写入IO设备的** 。术语 **流** 想要表达的是，**<u>随着时间的推移，字符是顺序生成或者消耗的</u>** 。

#### 标准输入输出对象

标准库定义了 4 个 IO 对象。为了处理输入，我们使用一个名为 `std::cin` 的 `std::istream` 类型的 **对象** 。这个对象也被称为标准输入。对于输出，我们使用一个名为 `std::cout` 的 `std::ostream` 类型的对象。

当我们读取 `std::cin` ，数据将从程序正在运行的窗口读入，当我们向 `std::cout` 、 `std::cerr` 和 `std::clog` 写入数据时，将会写到同一个窗口 。

#### 一个使用 IO 库的程序

通过使用 IO 库，我们可以扩展 `main` 程序，使之能提示用户输入两个数，然后输出它们的和：

```C++
#include <iostream>

int main(int argc, char const *argv[])
{
    std::cout << "Enter two numbers: " << std::endl;
    int v1 = 0;
    int v2 = 0;
    std::cin >> v1 >> v2;
    std::cout << "The sum of " << v1 << " and " << v2
              << " is " << v1 + v2 << std::endl;
    return 0;
}
```

程序的第一行 `#include <iostream>` 告诉编译器想要使用 `iostream` 库。尖括号中的名字指出了一个 **头文件** 。每个使用标准库设施的程序都必须包含相关的头文件。 `#include` 指令和头文件的名字必须写在同一行中。通常情况下， `#include` 指令必须出现在所有函数之外。**我们一般将一个程序所有的 `#include` 指令都放在源文件开始的位置** 。

#### 向流写入数据

在 C++ 中，一个表达式产生一个计算结果，它由一个或者多个运算对象和运算符组成。

**输出运算符（ `>>` ）** 接受两个运算对象： **<u>左侧的运算对象必须是一个 `std::ostream` 对象，右侧的运算对象是要打印的值。此运算符将给定的值写到给定的 `std::ostream` 对象中。计算结果就是我们写入给定值的那个 `std::ostream` 对象</u>** 。

第四行的语句我们可以等价的写成：

```C++
std::cout << "Enter two numbers:";
std::cout << std::endl;
```

**字符串字面值常量** ：是一对用双引号包围的字符序列。

**`std::endl`** ： **<u>操纵符，写入 `std::endl` 的效果是结束当前行并将与设备关联的缓冲区中的内容刷新到设备中</u>** 。缓冲区刷新操作可以保证到目前为止程序所产生的所有输出都真正写入输出流中，而不是仅停留在内存中等待写入流。

#### 使用标准库中的名字

**命名空间可以帮助我们避免不经意的名字定义冲突，以及使用库中相同名字导致的冲突** 。标准库定义的所有名字都在命名空间 `std` 中。

如果想使用一个命名空间中的名字，则必须使用 `namespace::name` 这样的形式，也就是 **作用域运算符（ `::` ）** 来指出特定的命名空间。

#### 从流中读取数据

**输入运算符（ `>>` ）** 与输出运算符类似， **它接受一个 `std::istream` 对象作为其左侧运算对象，接受一个对象作为其右侧运算对象。他从给定的 `std::istream` 中读入数据，并存入给定的对象中** 。

我们可以将语句等价的写成：

```C++
std::cin >> v1;
std::cin >> v2;
```

## 1.3 注释简介

错误的注释比完全没有注释更加糟糕。当修改代码时，不要忘记同时更新注释。

#### C++中注释的种类

C++ 中有两种注释：**单行注释** 和 **界定符对注释** 。

**单行注释** ： **<u>双斜线（ `//` ）开始，以换行符结束</u>** 。当前行右侧所有的内容都会被编译器忽略。这种注释可以包含任何的文本，包括额外的双斜线。

**界定符注释对** ：这种方式继承自C语言，以 `/*` 开始，以 `*/` 结束，可以包含除了 `*/` 之外的任何内容。包括换行符。

当注释界定符跨越多行时，最好能显式指出其内部的程序行都属于多行注释的一部分。我们所采用的风格是：**注释内的每行都以一个星号开头，从而指出整个范围都是多行注释的一部分** 。

#### 注释界定符不能嵌套

**<u>一个注释不能嵌套在另一个注释之内。如果进行嵌套会产生很复杂的错误</u>** 。

我们通常需要在调试期间注释掉一些代码。由于这些代码可能包含界定符形式的注释，所以我们 **使用单行注释的方法来进行操作** 。

## 1.4 控制流

语句一般是顺序执行的：**语句块的第一条语句首先执行，然后是第二条语句，依此类推** 。

### 1.4.1 `while` 语句

`while` 语句反复执行一段代码，直到给定的条件为假为止。

```C++
#include <iostream>

int main(int argc, char const *argv[])
{
    int sum = 0;
    int val = 1;
    while (val <= 10) {
        sum += val;
        ++val;
    }
    std::cout << "Sum of 1 to 10 inclusive is ";
    std::cout << sum << std::endl;
    return 0;
}
```

`while` 语句的形式为：

```C++
while (condition) {
    statements;
}
```

`while` 语句的执行过程是： **<u>交替的检测 `condition` 条件和执行关联的语句 `statements` ，直至 `condition` 为假时停止。所谓条件就是产生真或者假的结果的表达式。只要 `condition` 为真， `statements` 就会被执行</u>** 。

条件中使用了 **小于等于运算符** 来比较 `val` 和 `10` 的大小关系。

所谓语句块，就是 **用花括号包围的零条或者多条语句的序列** 。语句块也是语句的一种，在任何要求使用语句的地方都可以使用语句块。

**复合赋值运算符** ：将其右侧的运算对象加到左侧运算对象上，将结果保存到左侧的运算对象中。

**前置递增运算符** ：将运算对象的值增加 `1` 。

### 1.4.2 `for` 语句

每个 `for` 语句都包含了两部分，**循环头和循环体** 。循环头控制循环体的执行次数，它由三部分组成： **一个初始化语句、一个循环条件以及一个表达式** 。

**定义在初始化语句中的变量只能在 `for` 循环之内使用** ，在循环结束之后是不能使用的。**<u>初始化语句只在 `for` 循环入口处执行一次</u>** 。

循环体每次执行之前都会检查循环条件。如果条件为真然后就依次执行循环体和表达式，直到循环条件为假。

简要重述一下 `for` 循环的总体执行流程：

1. **执行初始化语句，初始化语句中的变量只能在循环内使用** 。
2. **检测循环条件是否为真，如果为真就依次执行循环体和表达式，否则退出循环** 。
3. **重复 2** 。

### 1.4.3 读取数量不定的输入数据

我们可以将标准输入语句当作循环语句的条件来完成不定量的数据输入。

**<u>当我们使用一个 `std::istream` 对象作为条件时，其效果是检测流的状态</u>** 。如果流是有效的，即流未遇到错误，那么检测成功。当遇到 **文件结束符（ `EOF` ）** ，或者遇到一个无效的输入时， `std::istream` 对象的状态会变为无效。处于无效状态的 `std::istream` 对象会使条件变为假。

### 1.4.4 `if` 语句

**`if` 语句也对一个条件进行求值。如果条件为真，则执行程序块；否则不执行程序块或者执行 `else` 块中的语句** 。

#### C++ 程序的缩进与格式

C++ 程序很大程度上是格式自由的，也就是说，我们在哪里放置花括号、缩进、注释以及换行符通常不会影响程序的语义。其他的格式总是存在的。**当你要选择一种风格时，就要坚持使用** 。

## 1.5 类简介

在 C++ 中，我们通过定义一个类来定义自己的数据结构。一个类定义了一个类型，以及于其关联的一组操作。

习惯上，**我们约定 C++ 的头文件被定义成 `hpp` 后缀的文件**。

### 1.5.1 `Sales_item` 类

每个类实际上都定义了一个新的类型，其类型名就是类名。因此，我们的 `Sales_item` 类定义了一个名为 `Sales_item` 的类型。与内置类型一样，我们可以定义类类型的变量：

```C++
Sales_item item; // item 的类型是 Sales_item
```

这个表达式声明了一个 `Sales_item` 类型的对象。

#### 关键概念：类定义了行为

类 `Sales_item` 的作者定义了类对象可以执行的所有动作。一般而言，**<u>类的作者决定了类类型对象上可以使用的所有操作</u>** 。

下面的程序从标准输入中读入数据，存入一个 `Sales_item` 对象中，然后将 `Sales_item` 的内容写回到标准输出中：

```C++
#include <iostream>
#include "Sales_item.h"

int main(int argc, char const *argv[])
{
    Sales_item book;
    // 以下两个操作需要涉及运算符的重载
    std::cin >> book; // 这里需要自己自定义标准输入的输入方式
    std::cout << book << std::endl; // 这里也需要自定义标准输出的方式
    return 0;
}
```

包含来自标准库的头文件时需要使用尖括号包围， **对于不属于标准库的文件，则需要使用双引号来包围** 。

**自定义类的对象的四则运算同样需要在类中进行运算符的重载** 。

### 1.5.2 初识成员函数

如果想要将两个 `Sales_item` 对象相加的程序首先应该检查两个对象是否具有相同的 `ISBN` 。

```C++
#include <iostream>
#include "Sales_item.h"

int main(int argc, char const *argv[])
{
    Sales_item item1;
    Sales_item item2;
    std::cin >> item1 >> item2;
    // 首先检查 item1 和 item2 是否表示相同的书
    if (item1.isbn() == item2.isbn()) {
        std::cout << item1 + item2 << std::endl;
        return 0;
    } else {
        std::cerr << "Data must refer to same ISBN" << std::endl;
        return -1; // 返回 -1 表示失败
    }
}
```

#### 什么是成员函数

成员函数是 **<u>定义为类的一部分的函数，有时也被称为 方法</u>** 。我们通常 **<u>使用类的对象来调用成员函数</u>** 。使用 **点运算符（ `.` ）** 来表达我们需要通过一个对象来调用成员函数来获取这个对象的属性。点运算符只能用于类的对象。 **<u>其左侧运算对象必须是一个类类型的对象，右侧运算对象必须是该类型的一个成员名，运算结果为右侧运算对象的指定成员</u>** 。

当使用点运算符访问一个成员函数时，通常我们需要调用这个函数。 **我们使用 调用运算符（`()`） 来调用一个函数（也就是一个可以被调用的对象）。调用运算符是一对圆括号** ，里面放置 **实参列表（argument list）** （实参列表可能为空）。

## 1.6 书店程序

```C++
#include <iostream>
#include "Sales_item.hpp"

int main(int argc, char** argv)
{
    Sales_item total;
    if (std::cin >> total) {
        Sales_item trans;
        while (std::cin >> trans) {
            if (total.isbn() == trans.isbn()) {
                total += trans;
            } else {
                std::cout << total << std::endl;
                total = trans;
            }
        }
        std::cout << total << std::endl;
    } else {
        std::cerr << "Error: No Data Input." << std::endl;
        return -1;
    }
    return 0;
}
```

我们可以借助 **辅助程序** 文件夹中的 `Sales_item.hpp` 文件来运行以上程序。